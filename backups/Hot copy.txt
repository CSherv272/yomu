import { useEffect } from 'react';
import * as mangastream from '../content-source/mangakakalot.ts';
import * as sideMenu from '../components/SideMenu.tsx';
import * as searchPane from '../content-components/Search.tsx';
import '../stylings/content/search.css';

function addMetaInfo(details: HTMLElement, titleText: string){
          // add a title to the details section

          const hbox = document.createElement('div');
          hbox.setAttribute('class', 'hbox1');

          const container = document.createElement('div');
          container.setAttribute('class', 'grid-item-container');

          const title = document.createElement('div');
          title.setAttribute('class', 'grid-item-title');
          title.textContent = titleText; // set text content directly
          container.appendChild(title);

          hbox.appendChild(container);

          details.appendChild(hbox);
}

function startLoadingAnimation() {

  const searchGrid = document.querySelector('.search-grid');

  if (searchGrid === null) {
    return;
  }

  searchGrid.innerHTML = '';

  const loading = document.createElement('div');
  loading.setAttribute('class', 'loading');
  searchGrid.appendChild(loading);
}

function search() {
    const searchGrid = document.querySelector('.search-grid');

    if (searchGrid === null) {
      return;
    }

    startLoadingAnimation();

    //call a js function asyncronously outside of this file
    mangastream.fetchRecent().then((entries) => {

      console.log(entries);
      searchPane.loadEntries(searchGrid, entries);

      /* 
      searchGrid.innerHTML = '';

      for (let i = 0; i < entries.length; i++) {
        if (searchGrid !== null) {
  
          const mangaEntry: {
            url: string;
            alt: string;
            img: string;
        } = entries[i];

        console.log(mangaEntry.img);
  
        const img = document.createElement('div');
        img.setAttribute('class', 'grid-item'); // add the class attribute
        img.style.backgroundImage = `url(${mangaEntry.img})`;
  
        // create a details section for the grid item and add it to the image
        const details = document.createElement('div');
        details.setAttribute('class', 'grid-item-details');
        img.appendChild(details);
  
        // add a title to the details section
        addMetaInfo(details, mangaEntry.alt);
        }
      }
      */


    })
}




export default function hot() {  

  sideMenu.toggle(document.getElementById('sidemenu-hot')!);

  const items = document.querySelectorAll('.grid-item');
  items.forEach(item => {
    if (item.scrollHeight > item.clientHeight) {
      const overflowThreshold = item.clientHeight * 0.5; // set threshold to 50%
      item.addEventListener('scroll', () => {
        if (item.scrollTop > overflowThreshold) {
          item.classList.add('fading');
          item.classList.remove('visible');
        } else {
          item.classList.remove('fading');
          item.classList.add('visible');
        }
      });
    }
  });

  useEffect(() => {
    search();
  }, []);

  return (
    <>
      <div className='content-search'>
          <div className="search-grid"></div>
      </div>
    </>
  );
  
}




    // const url = 'https://readmanganato.com/manga-va953509';
    // const alt = 'Komi-san wa Komyushou Desu';
    // const img = 'https://avt.mkklcdnv6temp.com/25/s/2-1583466695.jpg';

    // const state = <MangaDetails manga={{
    //   url: url,
    //   alt: alt,
    //   img: img
    // }}/>;

    // toggle(document.getElementById('sidemenu-search')!);
    // State.updateState(state);


    
  const anime = await aniData;

  const name = `https://animeflix.live/watch/${anime.title.romaji.replace(":", "-").replace(" ", "-").toLowerCase()}-episode-1/`;

  console.log(name);

  const iframe = document.createElement('iframe');
  iframe.src = name;
  iframe.allow = 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture';
  iframe.allowFullscreen = true;

  // Add the iframe to the DOM
  const mangaDetailsPane = document.querySelector('.mangadetails-pane');
  if (mangaDetailsPane) {
    //mangaDetailsPane.appendChild(iframe);
  } else {
    console.error('Could not find mangadetails-pane element');
  }